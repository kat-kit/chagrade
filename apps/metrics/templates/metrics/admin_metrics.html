{# TODO: Replace all the context/templatefilter/templatetag with proper context variables #}
{% extends 'base.html' %}
{% load static %}
{% load homework_tags %}

{% block title %}Welcome{% endblock %}

{% block extra_head %}
    <style>
        .charts-container {
            margin: 40px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .chart-container {
            margin-top: 30px;
            margin-bottom: 20px;
            width: 350px;
        }

        .condensed {
            margin: 0.5vh 0 0 0 !important;
            padding: 0.5vh 0 0 0 !important;
        }

        .no-padding {
            padding: 1vh 0 0 0 !important;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.js"></script>
{% endblock %}

{% block content %}
    <div class="ui centered grid">
        <div class="row">
            <div class="fourteen wide column">
                <div class="ui header">Chagrade Metrics</div>
                <div class="ui grid">
                    users tab
                        instructors
                        students
                    klasses tab
                        klases created
                </div>
                {% if definition %}
                    {#                    {% if definition.team_based %}#}
                    {% with definition|get_last_submission:user.pk as submission %}
                        {% with submission|get_last_grade as grade %}
                            <div class="ui message">
                                <div class="content">
                                    <a style="margin-bottom: 20px;" href="{{ submission.get_challenge_url }}"
                                       class="ui blue button">View Challenge</a>
                                    <a style="margin-bottom: 20px;" href="{% url "homework:overview" klass_pk=definition.klass.pk %}"
                                       class="ui blue button">View Homeworks</a>
                                    <a style="margin-bottom: 20px;" href="{% url "homework:submission_list" definition_pk=definition.pk %}"
                                       class="ui blue button">View </a>
                                    {% if definition.starting_kit_github_url %}
                                        <a href="{{ definition.starting_kit_github_url }}" class="ui blue button">Goto Starting
                                            Kit</a><br>
                                    {% endif %}
                                    {% if definition.team_based %}
                                        <div style="margin-top: 2vh; margin-bottom: 2.5vh; margin-left: 0;"
                                             class="ui red label">Graded as teamwork
                                        </div>
                                    {% endif %}

                                    <div class="ui grid">
                                        <div class="column">
                                            <div class="ui header">Github Information</div>
                                            <div class="ui divider"></div>
{#                                            <div class="ui content">#}
{#                                                <p>Date: {{ submission.created }}</p>#}
{#                                                <p>Commit hash: {{ submission.commit_hash|slice:"7" }}</p>#}
{#                                                <p>{{ submission.github_url }}</p>#}
{#                                                <p>Repository Name: {{ submission.github_repo_name }}</p>#}
{#                                                <p>Branch Name: {{ submission.github_branch_name }}</p>#}
{#                                            </div>#}
                                            <submission-detail-github submission_pk="{{ submission.pk }}" hash="{{ submission.commit_hash }}" user_pk="{{ request.user.pk }}"></submission-detail-github>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        {% endwith %}
                    {% endwith %}
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_script %}
    <script src="https://cdn.jsdelivr.net/npm/luxon@1.16.0/build/global/luxon.min.js"></script>
{% endblock %}
