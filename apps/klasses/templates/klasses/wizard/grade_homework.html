{% extends 'klasses/wizard/wizard_base.html' %}
{% load homework_tags %}

{% block wizard_title %}
    <h2 class="ui massive header" style="font-size: 56px;">Grade Homework</h2>
{% endblock %}

{% block wizard_content %}
    <div class="ui fourteen wide column message">
        <div style="overflow-x: scroll;">
            <h1>Students</h1>
            <span>
                <a href="{% url 'homework:get_grades_csv' klass_pk=klass.pk %}" class="ui blue button">Download CSV</a>
            </span>
            <table class="ui sortable table">
                <thead>
                <tr>
                    <th></th>
                    <th></th>
                    <th></th>
                    {% for homework_def in klass.homework_definitions.all %}
                        <th colspan="2">
                            {{ homework_def.name }}
                            <a href="{% url "klasses:homework_answers" definition_pk=homework_def.pk klass_pk=klass.pk %}" class="ui blue icon button table-header-link">
                                <i class="ui th list icon"></i>
                            </a>
                        </th>
                    {% endfor %}
                </tr>
                <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Team</th>
                    {% for homework_def in klass.homework_definitions.all %}
                        <th>Grade</th>
                        <th>Edit</th>
                    {% endfor %}
                </tr>
                </thead>
                <tbody>
                {% for student in klass.enrolled_students.all %}
                    <tr>
                        <td>
                            {{ forloop.counter }}
                        </td>
                        <td>{{ student.user.username }}</td>
                        <td>{{ student.team.name }}</td>
                        {% for homework_def in klass.homework_definitions.all %}
                            {% with homework_def|get_last_submission:student.user.pk as submission %}
                                {% with submission|get_last_grade_teacher as grade %}
                                    {% if not submission %}
                                        <td style="text-align: center;" colspan="2"><div class="ui red label">No Submission</div></td>
                                    {% else %}
                                        <td style="text-align: center;">
                                            {{ grade.text_grade }}
                                        </td>
                                        <td style="text-align: center;">
                                            {% if not grade %}
                                                {% if homework_def.jupyter_notebook_enabled %}
                                                    <a href="{% url "homework:grade_homework" klass_pk=klass.pk submission_pk=submission.pk %}"
                                                       class="ui orange button">Grade</a>
                                                {% else %}
                                                    <a href="{% url "homework:grade_homework" klass_pk=klass.pk submission_pk=submission.pk %}"
                                                       class="ui gray button">Grade</a>
                                                {% endif %}
                                            {% else %}
                                                {% if grade.published %}
                                                    {% if grade.needs_review and homework_def.jupyter_notebook_enabled %}
                                                        <a href="{% url "homework:edit_grade" klass_pk=klass.pk submission_pk=submission.pk grade_pk=grade.pk %}" class="ui orange button">Edit Grade</a>
                                                    {% else %}
                                                        <a href="{% url "homework:edit_grade" klass_pk=klass.pk submission_pk=submission.pk grade_pk=grade.pk %}" class="ui green button">Edit Grade</a>
                                                    {% endif %}
                                                {% else %}
                                                    {% if grade.needs_review and homework_def.jupyter_notebook_enabled %}
                                                        <a href="{% url "homework:edit_grade" klass_pk=klass.pk submission_pk=submission.pk grade_pk=grade.pk %}" class="ui orange button">Edit Grade</a>
                                                    {% else %}
                                                        <a href="{% url "homework:edit_grade" klass_pk=klass.pk submission_pk=submission.pk grade_pk=grade.pk %}" class="ui yellow button">Edit Grade</a>
                                                    {% endif %}
                                                {% endif %}
                                            {% endif %}
                                        </td>
                                    {% endif %}
                                {% endwith %}
                            {% endwith %}
                        {% endfor %}
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            <div class="ui horizonatal relaxed list">
                <div class="ui gray label">Not Graded</div>
                <div class="ui yellow label">Grade Not Published</div>
                <div class="ui green label">Grade Published</div>
                <div class="ui orange label">Jupyter Notebook Needs Review</div>
            </div>
        </div>
    </div>
{% endblock %}
